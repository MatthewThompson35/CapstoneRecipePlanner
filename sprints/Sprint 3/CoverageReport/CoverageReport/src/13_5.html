<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\matth\Desktop\capstone\CapstoneRecipePlanner\code\RecipePlannerApplication\RecipePlannerDesktopApp\RecipeDetailsPage.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using RecipePlannerLibrary.Database;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using RecipePlannerLibrary;
using RecipePlannerLibrary.Models;
using static System.Windows.Forms.VisualStyles.VisualStyleElement;
using static System.Windows.Forms.AxHost;
using System.Reflection;
using System.Diagnostics;

namespace RecipePlannerDesktopApplication
{
    /// &lt;summary&gt;
    ///     Recipe Detail Page partial class.
    /// &lt;/summary&gt;
    public partial class RecipeDetailsPage : Form
    {
        private Homepage homepage;
        private string selectedDay;
        private string selectedMealType;

        //private PlannedMealDal mealDal;
        
        /// &lt;summary&gt;
        ///     Initializes the recipe details page for the recipes.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;page&quot;&gt;The homepage.&lt;/param&gt;
        public RecipeDetailsPage()
        {
            InitializeComponent();

            
        }

        public RecipeDetailsPage(Homepage page) :this(){
            this.homepage = page;
            this.recipeDetailsTextBox.Text = this.displayRecipeDetails();

            this.populateDayComboBoxValues();
            this.populateMealTypeComboBoxValues();
            this.populateWeekComboBoxValues();

            this.selectedDay = &quot;&quot;;
            this.selectedMealType = &quot;&quot;;

        }

        private void backButton_Click(object sender, EventArgs e)
        {
            this.Hide();

            Homepage homepage = new Homepage();
            homepage.Show();

        }

        private string displayRecipeDetails()
        {
            string output = null;

            string description = this.homepage.GetSelectedRecipe().Name + Environment.NewLine + this.homepage.GetSelectedRecipe().Description + Environment.NewLine + Environment.NewLine;

            string steps = &quot;Steps&quot; + Environment.NewLine;

            foreach (var step in RecipeDAL.getStepsForRecipe(this.homepage.GetSelectedRecipe().RecipeId, Connection.ConnectionString))
            {
                steps += step.stepNumber + &quot;. &quot; + step.stepDescription + Environment.NewLine;
            }

            string ingredients = Environment.NewLine + &quot;Ingredients&quot; + Environment.NewLine;

            foreach (var ingredient in RecipeDAL.getIngredientsForRecipe(this.homepage.GetSelectedRecipe().RecipeId, Connection.ConnectionString))
            {
                ingredients += ingredient.Quantity + &quot; &quot; + ingredient.Measurement + &quot; &quot; + ingredient.IngredientName + Environment.NewLine;
            }
            
            output += description + steps + ingredients;
            return output;
        }

        private void addToMealPlanButton_Click(object sender, EventArgs e)
        {
            DayOfWeek day = (DayOfWeek)Enum.Parse(typeof(DayOfWeek), this.selectedDay);

            if (this.weekComboBox.SelectedItem.Equals(&quot;This Week&quot;))
            {
                PlannedMealDal.addPlannedMeal(Connection.ConnectionString, this.getCurrentRecipe().RecipeId, this.selectedDay, this.selectedMealType, GetDateOfCurrentWeekDay(day));
            } else
            {
                PlannedMealDal.addPlannedMeal(Connection.ConnectionString, this.getCurrentRecipe().RecipeId, this.selectedDay, this.selectedMealType, GetDateOfNextWeekDay(day));
            }
            
            
            var mealsPage = new PlannedMealsPage();
            this.Hide();
            mealsPage.Show();

        }

        public DateTime GetDateOfNextWeekDay(DayOfWeek dayOfWeek)
        {
            DateTime nextWeek = DateTime.Today.AddDays(7);
            int daysUntilNextWeekDay = ((int)dayOfWeek - (int)nextWeek.DayOfWeek);
            if (daysUntilNextWeekDay &lt; 0)
            {
                daysUntilNextWeekDay += 7;
            }
            return nextWeek.AddDays(daysUntilNextWeekDay);
        }

        public DateTime GetDateOfCurrentWeekDay(DayOfWeek dayOfWeek)
        {
            int daysUntilCurrentWeekDay = ((int)dayOfWeek - (int)DateTime.Today.DayOfWeek);
            if (daysUntilCurrentWeekDay &lt; 0)
            {
                daysUntilCurrentWeekDay += 7;
            }
            return DateTime.Today.AddDays(daysUntilCurrentWeekDay);
        }

        public string GetPlannedMealWeek(PlannedMealWeeks mealWeek)
        {
            switch (mealWeek)
            {
                case PlannedMealWeeks.ThisWeek:
                    return &quot;This Week&quot;;
                case PlannedMealWeeks.NextWeek:
                    return &quot;Next Week&quot;;
            }
            return &quot;&quot;;
        }

        public Recipe getCurrentRecipe()
        {
            return this.homepage.GetSelectedRecipe();
        }

        private void populateDayComboBoxValues()
        {
            foreach (var currentDay in Enum.GetValues(typeof(DayOfWeek)))
            {
                this.daysComboBox.Items.Add(currentDay.ToString());
            }
        }

        private void populateMealTypeComboBoxValues()
        {
            foreach (var mealType in Enum.GetValues(typeof(MealTypes)))
            {
                this.mealTypeComboBox.Items.Add(mealType.ToString());
            }
        }

        private void populateWeekComboBoxValues()
        {
            foreach (var week in Enum.GetValues(typeof(PlannedMealWeeks)))
            {
                this.weekComboBox.Items.Add(this.GetPlannedMealWeek((PlannedMealWeeks)week));
            }
        }


        private void daysComboBox_SelectedIndexChanged(object sender, EventArgs e)
        {
            //PlannedMealsPage mealsPage = new PlannedMealsPage();

            this.selectedDay = this.daysComboBox.SelectedItem.ToString();
        }

        private void mealTypeComboBox_SelectedIndexChanged(object sender, EventArgs e)
        {
            this.selectedMealType = this.mealTypeComboBox.SelectedItem.ToString();
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[35,9,35,35,0],[36,9,36,10,0],[37,13,37,35,0],[40,9,40,10,0],[42,50,42,56,0],[42,56,42,57,0],[43,13,43,34,0],[44,13,44,74,0],[46,13,46,46,0],[47,13,47,51,0],[48,13,48,47,0],[50,13,50,35,0],[51,13,51,40,0],[53,9,53,10,0],[56,9,56,10,0],[57,13,57,25,0],[59,13,59,48,0],[60,13,60,29,0],[62,9,62,10,0],[65,9,65,10,0],[66,13,66,34,0],[68,13,68,187,0],[70,13,70,58,0],[72,13,72,20,0],[72,22,72,30,0],[72,31,72,33,0],[72,34,72,134,0],[73,13,73,14,0],[74,17,74,94,0],[75,13,75,14,0],[77,13,77,92,0],[79,13,79,20,0],[79,22,79,36,0],[79,37,79,39,0],[79,40,79,146,0],[80,13,80,14,0],[81,17,81,139,0],[82,13,82,14,0],[84,13,84,57,0],[85,13,85,27,0],[86,9,86,10,0],[89,9,89,10,0],[90,13,90,88,0],[92,13,92,68,0],[93,13,93,14,0],[94,17,94,181,0],[95,13,95,14,0],[96,13,96,14,0],[97,17,97,178,0],[98,13,98,14,0],[101,13,101,52,0],[102,13,102,25,0],[103,13,103,30,0],[105,9,105,10,0],[108,9,108,10,0],[109,13,109,59,0],[110,13,110,83,0],[111,13,111,42,0],[112,13,112,14,0],[113,17,113,43,0],[114,13,114,14,0],[115,13,115,59,0],[116,9,116,10,0],[119,9,119,10,0],[120,13,120,92,0],[121,13,121,45,0],[122,13,122,14,0],[123,17,123,46,0],[124,13,124,14,0],[125,13,125,68,0],[126,9,126,10,0],[129,9,129,10,0],[130,13,130,30,0],[133,21,133,40,0],[135,21,135,40,0],[137,13,137,23,0],[138,9,138,10,0],[141,9,141,10,0],[142,13,142,54,0],[143,9,143,10,0],[146,9,146,10,0],[147,13,147,20,0],[147,22,147,36,0],[147,37,147,39,0],[147,40,147,73,0],[148,13,148,14,0],[149,17,149,68,0],[150,13,150,14,0],[151,9,151,10,0],[154,9,154,10,0],[155,13,155,20,0],[155,22,155,34,0],[155,35,155,37,0],[155,38,155,71,0],[156,13,156,14,0],[157,17,157,70,0],[158,13,158,14,0],[159,9,159,10,0],[162,9,162,10,0],[163,13,163,20,0],[163,22,163,30,0],[163,31,163,33,0],[163,34,163,74,0],[164,13,164,14,0],[165,17,165,94,0],[166,13,166,14,0],[167,9,167,10,0],[171,9,171,10,0],[174,13,174,74,0],[175,9,175,10,0],[178,9,178,10,0],[179,13,179,83,0],[180,9,180,10,0]]);
    </script>
  </body>
</html>