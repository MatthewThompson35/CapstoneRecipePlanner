<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\matth\Desktop\capstone\CapstoneRecipePlanner\code\RecipePlannerApplication\RecipePlannerLibrary\Database\PlannedMealDal.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using MySql.Data.MySqlClient;

namespace RecipePlannerLibrary.Database
{
    public class PlannedMealDal
    {
        #region Methods

        public static void addPlannedMeal(string connectionString, int recipeId, string day, string type, DateTime date)
        {
            using var connection = new MySqlConnection(connectionString);
            connection.Open();
            var query = @&quot;Insert into planned_recipe values (@recipeId, @day, @type, @date)&quot;;
            using var command = new MySqlCommand(query, connection);
            command.Parameters.Add(&quot;@recipeId&quot;, MySqlDbType.Int32).Value = recipeId;
            command.Parameters.Add(&quot;@day&quot;, MySqlDbType.VarChar).Value = day;
            command.Parameters.Add(&quot;@type&quot;, MySqlDbType.VarChar).Value = type;
            command.Parameters.Add(&quot;@date&quot;, MySqlDbType.Date).Value = date;
            using var reader = command.ExecuteReader();

            connection.Close();
        }

        public static Dictionary&lt;(string, string), int&gt; getThisWeeksMeals(string connectionString)
        {
            var thisWeeksMeals = new Dictionary&lt;(string, string), int&gt;();
            using var connection = new MySqlConnection(connectionString);
            connection.Open();
            var query = @&quot;SELECT *
            FROM planned_recipe
            WHERE YEARWEEK(dateUsed) = YEARWEEK(NOW());&quot;;
            using var command = new MySqlCommand(query, connection);
            using var reader = command.ExecuteReader();
            while (reader.Read())
            {
                var recipeId = reader.GetInt32(0);
                var day = reader.GetString(1);
                var type = reader.GetString(2);
                thisWeeksMeals.Add((day, type), recipeId);
            }

            return thisWeeksMeals;
        }

        public static Dictionary&lt;(string, string), int&gt; getNextWeeksMeals(string connectionString)
        {
            var nextWeeksMeals = new Dictionary&lt;(string, string), int&gt;();
            using var connection = new MySqlConnection(connectionString);
            connection.Open();
            var query = @&quot;SELECT *
            FROM planned_recipe
            WHERE YEARWEEK(dateUsed) = YEARWEEK(DATE_ADD(NOW(), INTERVAL 1 WEEK));&quot;;
            using var command = new MySqlCommand(query, connection);
            using var reader = command.ExecuteReader();
            while (reader.Read())
            {
                var recipeId = reader.GetInt32(0);
                var day = reader.GetString(1);
                var type = reader.GetString(2);
                nextWeeksMeals.Add((day, type), recipeId);
            }

            return nextWeeksMeals;
        }

        public static void RemoveThisWeekMeal(string connectionString, int id, string day, string type, DateTime date)
        {
            using var connection = new MySqlConnection(connectionString);
            connection.Open();
            var query =
                @&quot;DELETE FROM planned_recipe WHERE recipeID = @id and dayOfTheWeek = @day and mealType = @type and dateUsed = @date;&quot;;
            using var command = new MySqlCommand(query, connection);
            command.Parameters.Add(&quot;@id&quot;, MySqlDbType.Int32).Value = id;
            command.Parameters.Add(&quot;@day&quot;, MySqlDbType.VarChar).Value = day;
            command.Parameters.Add(&quot;@type&quot;, MySqlDbType.VarChar).Value = type;
            command.Parameters.Add(&quot;@date&quot;, MySqlDbType.Date).Value = date;
            using var reader = command.ExecuteReader();
        }

        public static bool exists(string connectionString, string type, DateTime date)
        {
            using (var connection = new MySqlConnection(connectionString))
            {
                connection.Open();

                var command =
                    new MySqlCommand(
                        &quot;SELECT COUNT(*) &gt; 0 FROM planned_recipe WHERE dateUsed = @date AND mealType = @type&quot;,
                        connection);
                command.Parameters.AddWithValue(&quot;@date&quot;, date);
                command.Parameters.AddWithValue(&quot;@type&quot;, type);

                var result = (long) command.ExecuteScalar();
                var exists = result &gt; 0;

                connection.Close();

                return exists;
            }
        }

        public static void UpdateThisWeeksMeal(string connectionString, string day, string type, DateTime date,
            int recipeId)
        {
            using var connection = new MySqlConnection(connectionString);
            connection.Open();
            var query =
                @&quot;Update planned_recipe set recipeID = @id WHERE dayOfTheWeek = @day and mealType = @type and dateUsed = @date;&quot;;
            using var command = new MySqlCommand(query, connection);
            command.Parameters.Add(&quot;@id&quot;, MySqlDbType.Int32).Value = recipeId;
            command.Parameters.Add(&quot;@day&quot;, MySqlDbType.VarChar).Value = day;
            command.Parameters.Add(&quot;@type&quot;, MySqlDbType.VarChar).Value = type;
            command.Parameters.Add(&quot;@date&quot;, MySqlDbType.Date).Value = date;
            using var reader = command.ExecuteReader();
        }

       
    }
    #endregion
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,10,1],[13,13,13,74,1],[14,13,14,31,1],[15,13,15,94,1],[16,13,16,69,1],[17,13,17,85,1],[18,13,18,77,1],[19,13,19,79,1],[20,13,20,76,1],[21,13,21,56,1],[23,13,23,32,1],[24,9,24,10,1],[27,9,27,10,1],[28,13,28,74,1],[29,13,29,74,1],[30,13,30,31,1],[31,13,33,58,1],[34,13,34,69,1],[35,13,35,56,1],[36,13,36,34,1],[37,13,37,14,1],[38,17,38,51,1],[39,17,39,47,1],[40,17,40,48,1],[41,17,41,59,1],[42,13,42,14,1],[44,13,44,35,1],[45,9,45,10,1],[48,9,48,10,1],[49,13,49,74,1],[50,13,50,74,1],[51,13,51,31,1],[52,13,54,85,1],[55,13,55,69,1],[56,13,56,56,1],[57,13,57,34,1],[58,13,58,14,1],[59,17,59,51,1],[60,17,60,47,1],[61,17,61,48,1],[62,17,62,59,1],[63,13,63,14,1],[65,13,65,35,1],[66,9,66,10,1],[69,9,69,10,1],[70,13,70,74,1],[71,13,71,31,1],[72,13,73,135,1],[74,13,74,69,1],[75,13,75,73,1],[76,13,76,77,1],[77,13,77,79,1],[78,13,78,76,1],[79,13,79,56,1],[80,9,80,10,1],[83,9,83,10,1],[84,20,84,74,1],[85,13,85,14,1],[86,17,86,35,1],[88,17,91,37,1],[92,17,92,64,1],[93,17,93,64,1],[95,17,95,61,1],[96,17,96,41,1],[98,17,98,36,1],[100,17,100,31,1],[102,9,102,10,1],[106,9,106,10,1],[107,13,107,74,1],[108,13,108,31,1],[109,13,110,130,1],[111,13,111,69,1],[112,13,112,79,1],[113,13,113,77,1],[114,13,114,79,1],[115,13,115,76,1],[116,13,116,56,1],[117,9,117,10,1]]);
    </script>
  </body>
</html>