<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\matth\source\repos\CapstoneRecipePlanner\code\RecipePlannerApplication\RecipePlannerDesktopApp\IngredientsPage.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.ComponentModel;
using RecipePlannerLibrary;
using RecipePlannerLibrary.Database;
using RecipePlannerLibrary.Models;

namespace RecipePlannerDesktopApplication;

/// &lt;summary&gt;
///     Ingredients Page partial class.
/// &lt;/summary&gt;
/// &lt;seealso cref=&quot;System.Windows.Forms.Form&quot; /&gt;
public partial class IngredientsPage : Form
{
    #region Data members

    private DataGridViewRow selectedRow;
    private int page = 1;
    private readonly int pageSize = 8;
    private readonly int totalPages;
    private List&lt;Ingredient&gt; pageOneIngredients;

    #endregion

    #region Constructors

    /// &lt;summary&gt;
    ///     Initializes a new instance of the &lt;see cref=&quot;IngredientsPage&quot; /&gt; class.
    /// &lt;/summary&gt;
    public IngredientsPage()
    {
        this.InitializeComponent();

        try
        {
            var ingriedents = IngredientDAL.getIngredients();
            this.totalPages = (int) Math.Ceiling((double) ingriedents.Count / this.pageSize);
            this.pageOneIngredients = ingriedents
                .Skip((this.page - 1) * this.pageSize)
                .Take(this.pageSize)
                .ToList();
            var bindingList = new BindingList&lt;Ingredient&gt;(this.pageOneIngredients);
            this.ingredientsGridView.DataSource = bindingList;
            Refresh();
        }
        catch (Exception ex)
        {
            this.serverErrorLabel.Visible = true;
            this.ingredientsGridView.Enabled = false;
        }

        Refresh();
    }

    #endregion

    #region Methods

    private void logoutButton_Click(object sender, EventArgs e)
    {
        Hide();
        var login = new LoginPage();
        login.Show();
    }

    private void addIngredientButton_Click(object sender, EventArgs e)
    {
        this.displayAddIngredientsPage();
    }

    private void displayAddIngredientsPage()
    {
        Hide();
        var ingredientsPopup = new AddIngredientsPage(this);
        ingredientsPopup.Show();
    }

    private void removeIngredientButton_Click(object sender, EventArgs e)
    {
        this.removeSelectedIngredient();
    }

    private void removeSelectedIngredient()
    {
        try
        {
            if (this.selectedRow != null)
            {
                var id = 0;
                var name = this.selectedRow.Cells[0].Value;
                var quantity = (int) this.selectedRow.Cells[2].Value;
                var list = IngredientDAL.getIngredients();
                foreach (var item in list)
                {
                    if (item.name.Equals(name) &amp;&amp; item.quantity == quantity)
                    {
                        id = (int) item.id;
                    }
                }

                IngredientDAL.RemoveIngredient(id, Connection.ConnectionString);
                this.UpdateIngredientsGridView();
            }
        }
        catch (Exception ex)
        {
            this.serverErrorLabel.Visible = true;
        }
    }

    /// &lt;summary&gt;
    ///     Updates the ingredients view with the page one ingredients.
    /// &lt;/summary&gt;
    public void UpdateIngredientsGridView()
    {
        try
        {
            var ingredients = IngredientDAL.getIngredients();
            this.pageOneIngredients = ingredients
                .Skip((this.page - 1) * this.pageSize)
                .Take(this.pageSize)
                .ToList();
            var list = this.pageOneIngredients;
            var bindingList = new BindingList&lt;Ingredient&gt;(list);

            this.ingredientsGridView.DataSource = null;
            this.ingredientsGridView.DataSource = bindingList;
        }
        catch (Exception ex)
        {
            this.serverErrorLabel.Visible = true;
        }
    }

    private void ingredientsGridView_CellClick(object sender, DataGridViewCellEventArgs e)
    {
        var rowIndex = e.RowIndex;
        var columnIndex = e.ColumnIndex;
        if (rowIndex &gt;= 0)
        {
            this.selectedRow = this.ingredientsGridView.Rows[rowIndex];
            this.clickIngredientCell(columnIndex);
        }
    }

    private void clickIngredientCell(int columnIndex)
    {
        try
        {
            if (this.selectedRow != null)
            {
                var id = 0;
                var name = this.selectedRow.Cells[0].Value;
                var quantity = (int) this.selectedRow.Cells[2].Value;
                var list = IngredientDAL.getIngredients();
                foreach (var item in list)
                {
                    if (item.name.Equals(name) &amp;&amp; item.quantity == quantity)
                    {
                        id = (int) item.id;
                    }
                }

                if (columnIndex == 1)
                {
                    IngredientDAL.decrementQuantity(id, quantity);
                    this.UpdateIngredientsGridView();
                }

                if (columnIndex == 3)
                {
                    IngredientDAL.incrementQuantity(id, quantity);
                    this.UpdateIngredientsGridView();
                }
            }
        }
        catch (Exception ex)
        {
            this.serverErrorLabel.Visible = true;
            this.ingredientsGridView.Enabled = false;
        }
    }

    private void backButton_Click(object sender, EventArgs e)
    {
        Hide();

        var homepage = new Homepage();
        homepage.Show();
    }

    private void beginningButton_Click(object sender, EventArgs e)
    {
        this.page = 1;
        var ingredients = IngredientDAL.getIngredients();
        List&lt;Ingredient&gt; allIngredientsOnPage = ingredients
            .Skip((this.page - 1) * this.pageSize)
            .Take(this.pageSize)
            .ToList();

        this.pageLabel.Text = this.page.ToString();
        var list = allIngredientsOnPage;
        var bindingList = new BindingList&lt;Ingredient&gt;(list);

        this.ingredientsGridView.DataSource = null;
        this.ingredientsGridView.DataSource = bindingList;
    }

    private void prevButton_Click(object sender, EventArgs e)
    {
        if (this.page != 1)
        {
            this.page--;
            var ingredients = IngredientDAL.getIngredients();
            List&lt;Ingredient&gt; allIngredientsOnPage = ingredients
                .Skip((this.page - 1) * this.pageSize)
                .Take(this.pageSize)
                .ToList();

            this.pageLabel.Text = this.page.ToString();
            var list = allIngredientsOnPage;
            var bindingList = new BindingList&lt;Ingredient&gt;(list);

            this.ingredientsGridView.DataSource = null;
            this.ingredientsGridView.DataSource = bindingList;
        }
    }

    private void nextButton_Click(object sender, EventArgs e)
    {
        if (this.page != this.totalPages)
        {
            this.page++;
            var ingredients = IngredientDAL.getIngredients();
            List&lt;Ingredient&gt; allIngredientsOnPage = ingredients
                .Skip((this.page - 1) * this.pageSize)
                .Take(this.pageSize)
                .ToList();

            this.pageLabel.Text = this.page.ToString();
            var list = allIngredientsOnPage;
            var bindingList = new BindingList&lt;Ingredient&gt;(list);

            this.ingredientsGridView.DataSource = null;
            this.ingredientsGridView.DataSource = bindingList;
        }
    }

    private void lastButtonClick(object sender, EventArgs e)
    {
        this.page = this.totalPages;
        var ingredients = IngredientDAL.getIngredients();
        List&lt;Ingredient&gt; allIngredientsOnPage = ingredients
            .Skip((this.page - 1) * this.pageSize)
            .Take(this.pageSize)
            .ToList();

        this.pageLabel.Text = this.page.ToString();
        var list = allIngredientsOnPage;
        var bindingList = new BindingList&lt;Ingredient&gt;(list);

        this.ingredientsGridView.DataSource = null;
        this.ingredientsGridView.DataSource = bindingList;
    }

    #endregion
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,5,17,26,0],[18,5,18,39,0],[29,5,29,29,0],[30,5,30,6,0],[31,9,31,36,0],[34,9,34,10,0],[35,13,35,62,0],[36,13,36,94,0],[37,13,40,27,0],[41,13,41,84,0],[42,13,42,63,0],[43,13,43,23,0],[44,9,44,10,0],[45,9,45,29,0],[46,9,46,10,0],[47,13,47,50,0],[48,13,48,54,0],[49,9,49,10,0],[51,9,51,19,0],[52,5,52,6,0],[59,5,59,6,0],[60,9,60,16,0],[61,9,61,37,0],[62,9,62,22,0],[63,5,63,6,0],[66,5,66,6,0],[67,9,67,42,0],[68,5,68,6,0],[71,5,71,6,0],[72,9,72,16,0],[73,9,73,61,0],[74,9,74,33,0],[75,5,75,6,0],[78,5,78,6,0],[79,9,79,41,0],[80,5,80,6,0],[83,5,83,6,0],[85,9,85,10,0],[86,13,86,42,0],[87,13,87,14,0],[88,17,88,28,0],[89,17,89,60,0],[90,17,90,70,0],[91,17,91,59,0],[92,17,92,24,0],[92,26,92,34,0],[92,35,92,37,0],[92,38,92,42,0],[93,17,93,18,0],[94,21,94,77,0],[95,21,95,22,0],[96,25,96,44,0],[97,21,97,22,0],[98,17,98,18,0],[100,17,100,81,0],[101,17,101,50,0],[102,13,102,14,0],[103,9,103,10,0],[104,9,104,29,0],[105,9,105,10,0],[106,13,106,50,0],[107,9,107,10,0],[108,5,108,6,0],[114,5,114,6,0],[116,9,116,10,0],[117,13,117,62,0],[118,13,121,27,0],[122,13,122,48,0],[123,13,123,65,0],[125,13,125,56,0],[126,13,126,63,0],[127,9,127,10,0],[128,9,128,29,0],[129,9,129,10,0],[130,13,130,50,0],[131,9,131,10,0],[132,5,132,6,0],[135,5,135,6,0],[136,9,136,35,0],[137,9,137,41,0],[138,9,138,27,0],[139,9,139,10,0],[140,13,140,72,0],[141,13,141,51,0],[142,9,142,10,0],[143,5,143,6,0],[146,5,146,6,0],[148,9,148,10,0],[149,13,149,42,0],[150,13,150,14,0],[151,17,151,28,0],[152,17,152,60,0],[153,17,153,70,0],[154,17,154,59,0],[155,17,155,24,0],[155,26,155,34,0],[155,35,155,37,0],[155,38,155,42,0],[156,17,156,18,0],[157,21,157,77,0],[158,21,158,22,0],[159,25,159,44,0],[160,21,160,22,0],[161,17,161,18,0],[163,17,163,38,0],[164,17,164,18,0],[165,21,165,67,0],[166,21,166,54,0],[167,17,167,18,0],[169,17,169,38,0],[170,17,170,18,0],[171,21,171,67,0],[172,21,172,54,0],[173,17,173,18,0],[174,13,174,14,0],[175,9,175,10,0],[176,9,176,29,0],[177,9,177,10,0],[178,13,178,50,0],[179,13,179,54,0],[180,9,180,10,0],[181,5,181,6,0],[184,5,184,6,0],[185,9,185,16,0],[187,9,187,39,0],[188,9,188,25,0],[189,5,189,6,0],[192,5,192,6,0],[193,9,193,23,0],[194,9,194,58,0],[195,9,198,23,0],[200,9,200,52,0],[201,9,201,41,0],[202,9,202,61,0],[204,9,204,52,0],[205,9,205,59,0],[206,5,206,6,0],[209,5,209,6,0],[210,9,210,28,0],[211,9,211,10,0],[212,13,212,25,0],[213,13,213,62,0],[214,13,217,27,0],[219,13,219,56,0],[220,13,220,45,0],[221,13,221,65,0],[223,13,223,56,0],[224,13,224,63,0],[225,9,225,10,0],[226,5,226,6,0],[229,5,229,6,0],[230,9,230,42,0],[231,9,231,10,0],[232,13,232,25,0],[233,13,233,62,0],[234,13,237,27,0],[239,13,239,56,0],[240,13,240,45,0],[241,13,241,65,0],[243,13,243,56,0],[244,13,244,63,0],[245,9,245,10,0],[246,5,246,6,0],[249,5,249,6,0],[250,9,250,37,0],[251,9,251,58,0],[252,9,255,23,0],[257,9,257,52,0],[258,9,258,41,0],[259,9,259,61,0],[261,9,261,52,0],[262,9,262,59,0],[263,5,263,6,0]]);
    </script>
  </body>
</html>